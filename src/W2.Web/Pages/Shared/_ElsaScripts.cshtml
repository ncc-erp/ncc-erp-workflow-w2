<script src="/_content/Elsa.Designer.Components.Web/monaco-editor/min/vs/loader.js"></script>
<script type="module" src="/_content/Elsa.Designer.Components.Web/elsa-workflows-studio/elsa-workflows-studio.esm.js"></script>
<script>
    const elsaStudioRoot = document.querySelector('elsa-studio-root');

    elsaStudioRoot.addEventListener('initializing', e => {
        const elsaStudio = e.detail;
        elsaStudio.pluginManager.registerPlugin(AuthorizationMiddlewarePlugin);
    });

    function AuthorizationMiddlewarePlugin(elsaStudio) {
        const eventBus = elsaStudio.eventBus;

        eventBus.on('http-client-created', e => {
            e.service.register({
                onRequest(request) {
                    request.headers = { 'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() }
                    return request;
                }
            });
        });
    }
</script>